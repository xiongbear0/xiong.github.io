function generateKey(e){e&&(e.stopPropatation=!0,e.cancelBubble=!0);let t=parseInt(document.getElementById("select_key_size").value),n=new JSEncrypt({default_key_size:t});e&&(e.innerText="正在生成..."),new Promise(function(e){setTimeout(function(){e([n.getPrivateKey(),n.getPublicKey()])},50)}).then(function(t){document.getElementById("area_private_key").value=t[0],document.getElementById("area_public_key").value=t[1],e&&(e.innerText="生成密钥")})}function encrypt(){let e="",t=document.getElementById("area_original_text").value,n=document.getElementById("area_public_key").value,r=sizeof(n.substring(n.toUpperCase().indexOf("KEY-----")+9,n.toUpperCase().indexOf("-----END")-1)),a=0;a=r<66?5:r<88?21:r<133?53:r<225?117:r<404?245:r<577?373:501;let l=sizeof(t),u=Math.ceil(l/a),c="",o=0;if(t&&n)for(i=0;i<u;i++){c="";let r=!1;for(;!r;){let e=t.substr(o,1);if(""==e)break;let n=c+e;sizeof(n)>a?r=!0:(c=n,o++)}e+=getEncrypt(c,n),i<u-1&&(e+="|")}else n||(document.getElementById("area_public_key").value="Need Public Key");document.getElementById("area_cipher_text").value=e}function getEncrypt(e,t){let n=new JSEncrypt;return n.setPublicKey(t),n.encrypt(e)||""}function decrypt(){let e="",t=document.getElementById("area_cipher_text").value,n=document.getElementById("area_private_key").value;if(t&&n){let r=t.split("|");for(i in r){e+=getDecrypt(r[i],n)}}else n||(document.getElementById("area_private_key").value="Need Private Key");document.getElementById("area_original_text").value=e}function getDecrypt(e,t){let n=new JSEncrypt;return n.setPrivateKey(t),n.decrypt(e)||""}function sizeof(e){let t,n,i,r=0;for(n=0,i=e.length;n<i;n++)r+=(t=e.charCodeAt(n))<=127?1:t<=2047?2:t<=65535?3:4;return r}